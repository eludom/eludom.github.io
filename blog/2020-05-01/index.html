<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="//gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.69.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <script type="application/ld+json">
{
    "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/eludom.github.io\/"
    },
    "articleSection" : "Blog",
    "name" : "HOWTO: Using Pi-hole DNS to block ads.  The struggle continues…",
    "headline" : "HOWTO: Using Pi-hole DNS to block ads.  The struggle continues…",
    "description" : "\x3cp\x3e\x3cem\x3eThis article is a work in progress.  Updated: 2020-05-02.  This is\nturning into a bit of a catch-up on the state of DNS for me.\x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3eDay 03 and 04 of #100DaysToOffload.\x3c\/p\x3e\n\x3ch2 id=\x22intro\x22\x3eIntro\x3c\/h2\x3e\n\x3cp\x3eThe war against ads continues. \x3ca href=\x22https:\/\/pi-hole.net\/\x22\x3ehttps:\/\/pi-hole.net\/\x3c\/a\x3e looks like a\nreasonable, good, new?, open source entry in the war against ads. Get\n\x26lsquo;yer source\/install for linux at \x3ca href=\x22https:\/\/github.com\/pi-hole\/pi-hole\x22\x3ehttps:\/\/github.com\/pi-hole\/pi-hole\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3ePer Paul Vixie\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3enot even non-technical users need a \x26ldquo;public DNS\x26rdquo; to shield themselves\nfrom a lot of known-evil internet sites. check out @The_Pi_Hole or\nhave your 12yo child or cousin install it.\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e..but I always make things harder.\x3c\/p\x3e\n\x3cp\x3e\x3c!-- raw HTML omitted --\x3e\x3c!-- raw HTML omitted --\x3e\x3c\/p\x3e\n\n\n\n\x3cfigure\x3e\n    \n        \x3cimg src=\x22https:\/\/eludom.github.io\/ox-hugo\/pi-hole.png\x22 alt=\x22Figure 1: pi-hole console after a few hours on my system\x22\/\x3e \x3cfigcaption\x3e\n                \n                \x3cp\x3e\n                    Figure 1: pi-hole console after a few hours on my system\n                    \n                        \n                        \x3c\/p\x3e\n                \n            \x3c\/figcaption\x3e\x3c\/figure\x3e",
    "inLanguage" : "en-US",
    "author" : "eludom.github.ioGeorge Jones",
    "creator" : "eludom.github.ioGeorge Jones",
    "publisher": "eludom.github.ioGeorge Jones",
    "accountablePerson" : "eludom.github.ioGeorge Jones",
    "copyrightHolder" : "eludom.github.ioGeorge Jones",
    "copyrightYear" : "2020",
    "datePublished": "2020-05-01 00:00:00 -0400 EDT",
    "dateModified" : "2020-05-01 00:00:00 -0400 EDT",
    "url" : "https:\/\/eludom.github.io\/blog\/2020-05-01\/",
    "wordCount" : "968",
    "keywords" : [ "DNS","privacy","networking","HOWTO","Blog" ]
}
</script>

  
  <title>HOWTO: Using Pi-hole DNS to block ads.  The struggle continues… &middot; Curious Musings</title>

  
  <link type="text/css" rel="stylesheet" href="https://eludom.github.io/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://eludom.github.io/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://eludom.github.io/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://eludom.github.io/css/hyde.css">
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Righteous|Oswald|Merriweather|PT+Sans:400,400i,700">



 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://eludom.github.io/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://eludom.github.io/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Curious Musings" />

  
</head>

  <body class="theme-base-0a ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://eludom.github.io/"><h1>Curious Musings</h1></a>
    </div>
    <nav>
      <ul class="sidebar-nav">
        <h3>◾ Frequent</h3>
        
        
        <li>
          <a href="https://eludom.github.io/tags/life"> life <small>(15)</small></a>
        </li>
        
        
        
        <li>
          <a href="https://eludom.github.io/tags/100daystooffload"> 100daystooffload <small>(8)</small></a>
        </li>
        
        
        
        <li>
          <a href="https://eludom.github.io/tags/history"> history <small>(5)</small></a>
        </li>
        
        
        
        <li>
          <a href="https://eludom.github.io/tags/outdoors"> outdoors <small>(5)</small></a>
        </li>
        
        
        
        <li>
          <a href="https://eludom.github.io/tags/blogging"> blogging <small>(4)</small></a>
        </li>
        
        
        
        <li>
          <a href="https://eludom.github.io/tags/emacs"> emacs <small>(4)</small></a>
        </li>
        
        
        
        <li>
          <a href="https://eludom.github.io/tags/family"> family <small>(4)</small></a>
        </li>
        
        
        
        <li>
          <a href="https://eludom.github.io/tags/hiking"> hiking <small>(4)</small></a>
        </li>
        
        
        
        <li>
          <a href="https://eludom.github.io/tags/howto"> howto <small>(4)</small></a>
        </li>
        
        
        
        <li>
          <a href="https://eludom.github.io/tags/latin"> latin <small>(4)</small></a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <h4><a href="https://eludom.github.io/tags/">All Topics ►</a></h4>
        
        <h4><a href="https://eludom.github.io/blog/">All Posts ►</a></h4>
        

          <h3>◾ About </h3>
          <a href="https://eludom.github.io//about">George Jones</a>
          <a href="https://eludom.github.io//curious">Curious Musings</a>
          <img src="https://eludom.github.io/title-logo.png">
      </ul>
    </nav>
  </div>
</aside>

    <main class="content container">
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="HOWTO: Using Pi-hole DNS to block ads.  The struggle continues…"/>
<meta name="twitter:description" content="This article is a work in progress.  Updated: 2020-05-02.  This is
turning into a bit of a catch-up on the state of DNS for me.
Day 03 and 04 of #100DaysToOffload.
Intro
The war against ads continues. https://pi-hole.net/ looks like a
reasonable, good, new?, open source entry in the war against ads. Get
&lsquo;yer source/install for linux at https://github.com/pi-hole/pi-hole
Per Paul Vixie

not even non-technical users need a &ldquo;public DNS&rdquo; to shield themselves
from a lot of known-evil internet sites. check out @The_Pi_Hole or
have your 12yo child or cousin install it.

..but I always make things harder.





    
         
                
                
                    Figure 1: pi-hole console after a few hours on my system
                    
                        
                        
                
            "/>

<div class="post">
  <h1>HOWTO: Using Pi-hole DNS to block ads.  The struggle continues…</h1>
 <time datetime=2020-05-01T00:00:00-0400 class="post-date">2020-05-01 



    
      / <a href="https://eludom.github.io/tags/dns/"> dns</a>
      / <a href="https://eludom.github.io/tags/privacy/"> privacy</a>
      / <a href="https://eludom.github.io/tags/networking/"> networking</a>
      / <a href="https://eludom.github.io/tags/howto/"> howto</a>
</time>
<p><em>This article is a work in progress.  Updated: 2020-05-02.  This is
turning into a bit of a catch-up on the state of DNS for me.</em></p>
<p>Day 03 and 04 of #100DaysToOffload.</p>
<h2 id="intro">Intro</h2>
<p>The war against ads continues. <a href="https://pi-hole.net/">https://pi-hole.net/</a> looks like a
reasonable, good, new?, open source entry in the war against ads. Get
&lsquo;yer source/install for linux at <a href="https://github.com/pi-hole/pi-hole">https://github.com/pi-hole/pi-hole</a></p>
<p>Per Paul Vixie</p>
<blockquote>
<p>not even non-technical users need a &ldquo;public DNS&rdquo; to shield themselves
from a lot of known-evil internet sites. check out @The_Pi_Hole or
have your 12yo child or cousin install it.</p>
</blockquote>
<p>..but I always make things harder.</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>



<figure>
    
        <img src="https://eludom.github.io/ox-hugo/pi-hole.png" alt="Figure 1: pi-hole console after a few hours on my system"/> <figcaption>
                
                <p>
                    Figure 1: pi-hole console after a few hours on my system
                    
                        
                        </p>
                
            </figcaption></figure>

<h2 id="what">What</h2>
<ul>
<li>It&rsquo;s a local DNS server to block adds.</li>
</ul>
<h2 id="why">Why</h2>
<ul>
<li>Blocking ads is a moral good.</li>
<li>I&rsquo;ve not done home network hacking for a while.</li>
<li>I&rsquo;m moving into a bit of a more &ldquo;don&rsquo;t track me&rdquo; frame of mind.</li>
</ul>
<h2 id="when">When</h2>
<ul>
<li>Now, because I&rsquo;m home more during corona-virus.</li>
</ul>
<h2 id="how">How</h2>
<ul>
<li>Set up local server.</li>
<li>First on a Linux laptop that (usually) does not go off the net.</li>
<li>Then maybe on an old pogoplug or laptop.</li>
</ul>
<h2 id="install-it">Install It</h2>
<p>Here&rsquo;s what I did to instlal</p>
<dl>
<dt>[ ] basic install</dt>
<dd>On a Linux server, the <strong>basic</strong> install is
simple:
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">            sudo bash basic-install.sh
</code></pre></div></dd>
<dt>[ ] Static IP</dt>
<dd>But you will want a Linux box with a static IP
address. This may involve, e.g., convincing your wireless
router to hand out a the same static IP to a static IP</dd>
<dt>[ ] Tell other systems to use this IP for DNS</dt>
<dd>Again,
probably configuring your wireless router to specify your local
IP as the DNS server for DNS assignments via DHCP assignments.
You could also do this by configuring the individual devices to
use it.</dd>
<dt>[ ] Remember your admin password</dt>
<dd>Make note of the admin password during install</dd>
<dt>[ ] hit the local admin web server</dt>
<dd>Its a very nice.  It will
be at a something like  <a href="http://192.168.86.230/admin/index.php">http://192.168.86.230/admin/index.php</a>.</dd>
</dl>
<h2 id="test-it">Test It</h2>
<dl>
<dt>[ ] Look something up by hand</dt>
<dd>Use dig(1) or host(1).  Note
the <code>SERVER</code> in the response below that shows where the answer
came from.  If it&rsquo;s your IPS&rsquo;s DNS or Google, try again
(something&rsquo;s not configured right).  In my case 127.1 is right.</dd>
</dl>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">$ dig www.uu.net

; &lt;&lt;&gt;&gt; DiG 9.11.3-1ubuntu1.11-Ubuntu &lt;&lt;&gt;&gt; www.uu.net
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 54721
;; flags: qr rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;www.uu.net.			IN	A

;; ANSWER SECTION:
www.uu.net.		299	IN	CNAME	global.mci.com.
global.mci.com.		959	IN	CNAME	wac.C449.edgecastcdn.net.
wac.C449.edgecastcdn.net. 3599	IN	CNAME	gp1.wac.v2cdn.net.
gp1.wac.v2cdn.net.	3599	IN	A	152.195.32.39

;; Query time: 59 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Fri May 01 19:16:11 EDT 2020
;; MSG SIZE  rcvd: 146
</code></pre></div><ul>
<li>
<p><input disabled="" type="checkbox"> Check the query logs via the UI to make sure your target domain
showed.   Be aware of caching.  It may only show up the first
time you query.</p>
</li>
<li>
<p><input disabled="" type="checkbox"> Find your favorite 90s-era web site,
go hit it, and watch the counters</p>
<ul>
<li><a href="http://computershopper.com">http://computershopper.com</a></li>
<li><a href="http://www.yahoo.com">http://www.yahoo.com</a></li>
<li><a href="http://www.compuserve.com">http://www.compuserve.com</a></li>
<li><a href="http://www.aol.com">http://www.aol.com</a></li>
<li><a href="http://sears.com">http://sears.com</a> (get it while it lasts)</li>
</ul>
</li>
<li>
<p>If the counters go crazy and you don&rsquo;t see the expected
plethora of ads, you win.  If not dig deeper.</p>
</li>
<li>
<p>If you are already
using ad-blockers or browsers such as Brave that block ads, you
may have to test with something else (Firefox, Chrome, etc.)</p>
</li>
<li>
<p>Browser and other apps are getting cagey about using not using
the system DNS, using DOH, and otherwise not acting like you
expect them too.  Editing <code>/etc/resolv.conf</code> is not the whole
game anymore.</p>
</li>
</ul>
<h2 id="tools-you-may-want-to-use-learn-install">Tools you may want to use/learn/install</h2>
<dl>
<dt>dig</dt>
<dd>for making/testing queries by hand</dd>
<dt><a href="https://www.wireshark.org/">Wireshark</a></dt>
<dd>Use Wireshark to see what&rsquo;s going on on the wire,
who you&rsquo;re talking to, etc.</dd>
</dl>
<h2 id="the-things-you-learn">The things you learn</h2>
<ul>
<li>
<p>pi-hole can apparently function as a DHCP server itself.</p>
</li>
<li>
<p>You can choose your upstream DNS servers from a list with
options for IPv4, IPv6, DNSSEC/no DNSSEC, filtered/unfiltered.</p>
</li>
<li>
<p>Quad9 is one of the choices.  It looks to be really useful for
adding malware blocking to your domain.  See
<a href="https://www.quad9.net/faq/">https://www.quad9.net/faq/</a> for a useful bit of education.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>The logs are at <code>/var/log/pihole.log</code></p>
</li>
<li>
<p>Possibly use <a href="http://www.ranum.com/security/computer%5Fsecurity/papers/ai/">Marcus Ranums&rsquo;s principal of &ldquo;Artificial Ignorance&rdquo;</a>
to grep out the known and see what&rsquo;s left:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">        $  cat pihole.log.1  | egrep -v microsoft.com\|google\|amazon\|in-addr\|linkedin\|dropbox\|facebook\|messenger\|ubuntu\|github\|brave\|basicattention\|yahoo\|disqus\|twitter\|akamai\ | sed &#39;s/.*: //&#39;  | sort | uniq -c | sort -rn | head
        334 reply min-api.cryptocompare.com is &lt;CNAME&gt;
        334 reply ccc-api.cloudapp.net is 40.115.22.134
        334 query[A] min-api.cryptocompare.com from 127.0.0.1
        238 forwarded min-api.cryptocompare.com to 8.8.4.4
        143 cached min-api.cryptocompare.com is &lt;CNAME&gt;
        101 query[A] no-thanks.invalid.lan from 127.0.0.1
        101 query[A] no-thanks.invalid from 127.0.0.1
        101 forwarded min-api.cryptocompare.com to 8.8.8.8
        100 reply hfq2h9152m63.statuspage.io is &lt;CNAME&gt;
        100 query[A] rpt.cedexis.com from 127.0.0.1
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">        $ cat pihole.log.1  | egrep -v microsoft.com\|google\|amazon\|in-addr\|linkedin\|dropbox\|facebook\|messenger\|ubuntu\|github\|brave\|basicattention\|yahoo\|disqus\|twitter\|akamai\|compuserve\|aol | sed &#39;s/.*: //&#39;  | sort | uniq -c | sort -rn | tail -20
        1 cached imap.gmail.com is 2607:f8b0:400d:c0f::6d
        1 cached imap.gmail.com is 2607:f8b0:400d:c07::6d
        1 cached imap.gmail.com is 2607:f8b0:400d:c00::6d
        1 cached imap.gmail.com is 2607:f8b0:4004:c08::6d
        1 cached imap.gmail.com is 2607:f8b0:4004:c08::6c
        1 cached imap.gmail.com is 172.253.63.109
        1 cached imap.gmail.com is 172.253.63.108
        1 cached hosts-file.net is 3.234.198.254
        1 cached encrypted-tbn0.gstatic.com is 172.217.13.78
        1 cached dig is NXDOMAIN
        1 cached content-signature-2.cdn.mozilla.net is &lt;CNAME&gt;
        1 cached beacons-handoff.gcp.gvt2.com is 172.217.15.99
        1 cached beacons.gvt2.com is 172.217.13.227
        1 cached beacons.gcp.gvt2.com is &lt;CNAME&gt;
        1 cached beacons4.gvt2.com is 216.239.32.116
        1 cached beacons2.gvt2.com is 216.239.38.117
        1 cached beacons2.gvt2.com is 216.239.36.117
        1 cached beacons2.gvt2.com is 216.239.34.117
        1 cached beacons2.gvt2.com is 216.239.32.117
        1 cached article.smartasset.com is &lt;CNAME&gt;
</code></pre></div><p>What is this stuff?</p>
</li>
</ul>
<h2 id="tune-it">Tune it</h2>
<p>I&rsquo;m not sure all the devices in the house are using the P-hole
proxy.  If they are, then they are showing up as the single
device _gateway.   I need to understand this and figure out if I
can get other devices pulling wireless addresses via DHCP from
the WAP to use the Pi-hole DNS directly.   Stay tuned.</p>
<h2 id="post-incomplete-from-here">POST INCOMPLETE FROM HERE</h2>
<h2 id="migrate">Migrate</h2>
<h2 id="burn-in">Burn in</h2>
<h2 id="inflict-it-on-others">Inflict it on others</h2>
</div>
<hr>
<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "curiousmusings" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </main>

    
  </body>
</html>
